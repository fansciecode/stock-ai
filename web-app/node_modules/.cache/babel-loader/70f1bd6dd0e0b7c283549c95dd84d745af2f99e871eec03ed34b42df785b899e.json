{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Container,Typography,Box,Paper,Divider,Button,IconButton,List,ListItem,ListItemText,ListItemAvatar,ListItemSecondaryAction,Avatar,Badge,Tabs,Tab,CircularProgress,Chip,Menu,MenuItem}from'@mui/material';import{Notifications,DeleteOutline,CheckCircleOutline,ErrorOutline,InfoOutlined,EventAvailable,ShoppingBag,Message,MoreVert,ArrowBack}from'@mui/icons-material';import{useNavigate}from'react-router-dom';import axios from'axios';import{useAuth}from'../../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function TabPanel(props){const{children,value,index,...other}=props;return/*#__PURE__*/_jsx(\"div\",{role:\"tabpanel\",hidden:value!==index,id:`notification-tabpanel-${index}`,\"aria-labelledby\":`notification-tab-${index}`,...other,children:value===index&&/*#__PURE__*/_jsx(Box,{sx:{py:3},children:children})});}const NotificationScreen=()=>{const[notifications,setNotifications]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[tabValue,setTabValue]=useState(0);const[anchorEl,setAnchorEl]=useState(null);const[selectedNotificationId,setSelectedNotificationId]=useState(null);const navigate=useNavigate();const{user}=useAuth();useEffect(()=>{fetchNotifications();},[]);const fetchNotifications=async()=>{try{setLoading(true);const{data}=await axios.get('/api/notifications');setNotifications(data);setLoading(false);}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Failed to fetch notifications');setLoading(false);}};const handleTabChange=(event,newValue)=>{setTabValue(newValue);};const handleBack=()=>{navigate(-1);};const handleMenuClick=(event,notificationId)=>{setAnchorEl(event.currentTarget);setSelectedNotificationId(notificationId);};const handleMenuClose=()=>{setAnchorEl(null);setSelectedNotificationId(null);};const handleMarkAsRead=async()=>{try{await axios.patch(`/api/notifications/${selectedNotificationId}`,{read:true});// Update the notification in the local state\nsetNotifications(notifications.map(notification=>notification._id===selectedNotificationId?{...notification,read:true}:notification));handleMenuClose();}catch(err){console.error('Failed to mark notification as read:',err);}};const handleDeleteNotification=async()=>{try{await axios.delete(`/api/notifications/${selectedNotificationId}`);// Remove the notification from the local state\nsetNotifications(notifications.filter(notification=>notification._id!==selectedNotificationId));handleMenuClose();}catch(err){console.error('Failed to delete notification:',err);}};const handleMarkAllAsRead=async()=>{try{await axios.patch('/api/notifications/mark-all-read');// Update all notifications in the local state\nsetNotifications(notifications.map(notification=>({...notification,read:true})));}catch(err){console.error('Failed to mark all notifications as read:',err);}};const handleClearAll=async()=>{try{await axios.delete('/api/notifications/clear-all');// Clear all notifications from the local state\nsetNotifications([]);}catch(err){console.error('Failed to clear all notifications:',err);}};const handleNotificationClick=notification=>{// Mark as read when clicked\nif(!notification.read){handleMarkAsRead(notification._id);}// Navigate based on notification type\nswitch(notification.type){case'EVENT':navigate(`/event/${notification.entityId}`);break;case'ORDER':navigate(`/order/${notification.entityId}`);break;case'MESSAGE':navigate(`/chat/${notification.entityId}`);break;default:navigate('/dashboard');}};const getNotificationIcon=type=>{switch(type){case'EVENT':return/*#__PURE__*/_jsx(EventAvailable,{color:\"primary\"});case'ORDER':return/*#__PURE__*/_jsx(ShoppingBag,{color:\"secondary\"});case'MESSAGE':return/*#__PURE__*/_jsx(Message,{color:\"info\"});case'ALERT':return/*#__PURE__*/_jsx(ErrorOutline,{color:\"error\"});default:return/*#__PURE__*/_jsx(InfoOutlined,{color:\"action\"});}};const getFilteredNotifications=()=>{switch(tabValue){case 0:// All\nreturn notifications;case 1:// Unread\nreturn notifications.filter(notification=>!notification.read);case 2:// Events\nreturn notifications.filter(notification=>notification.type==='EVENT');case 3:// Orders\nreturn notifications.filter(notification=>notification.type==='ORDER');case 4:// Messages\nreturn notifications.filter(notification=>notification.type==='MESSAGE');default:return notifications;}};// Use demo data if no notifications are available\nconst demoNotifications=[{_id:'1',title:'New Event Invitation',message:'You have been invited to \"Summer Tech Conference 2023\"',createdAt:new Date(Date.now()-2*60*60*1000).toISOString(),read:false,type:'EVENT',entityId:'event-123'},{_id:'2',title:'Order Confirmed',message:'Your order #12345 has been confirmed and is being processed',createdAt:new Date(Date.now()-1*24*60*60*1000).toISOString(),read:true,type:'ORDER',entityId:'order-123'},{_id:'3',title:'New Message',message:'You have a new message from Event Organizer',createdAt:new Date(Date.now()-3*24*60*60*1000).toISOString(),read:false,type:'MESSAGE',entityId:'chat-123'},{_id:'4',title:'System Alert',message:'Your subscription will expire in 7 days. Please renew to avoid service interruption.',createdAt:new Date(Date.now()-5*24*60*60*1000).toISOString(),read:false,type:'ALERT',entityId:null}];const displayNotifications=notifications.length>0?notifications:demoNotifications;const filteredNotifications=tabValue===0?displayNotifications:getFilteredNotifications();const unreadCount=displayNotifications.filter(notification=>!notification.read).length;if(loading){return/*#__PURE__*/_jsx(Box,{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",minHeight:\"80vh\",children:/*#__PURE__*/_jsx(CircularProgress,{})});}if(error){return/*#__PURE__*/_jsx(Container,{maxWidth:\"md\",children:/*#__PURE__*/_jsxs(Box,{my:4,textAlign:\"center\",children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",color:\"error\",gutterBottom:true,children:error}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:fetchNotifications,children:\"Try Again\"})]})});}return/*#__PURE__*/_jsxs(Container,{maxWidth:\"md\",children:[/*#__PURE__*/_jsxs(Box,{my:4,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",mb:3,children:[/*#__PURE__*/_jsx(IconButton,{onClick:handleBack,sx:{mr:1},children:/*#__PURE__*/_jsx(ArrowBack,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",children:\"Notifications\"}),unreadCount>0&&/*#__PURE__*/_jsx(Badge,{badgeContent:unreadCount,color:\"error\",sx:{ml:2},children:/*#__PURE__*/_jsx(Notifications,{color:\"action\"})}),/*#__PURE__*/_jsx(Box,{sx:{flexGrow:1}}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",size:\"small\",onClick:handleMarkAllAsRead,sx:{mr:1},children:\"Mark All Read\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"error\",size:\"small\",onClick:handleClearAll,children:\"Clear All\"})]}),/*#__PURE__*/_jsxs(Paper,{elevation:3,children:[/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:handleTabChange,indicatorColor:\"primary\",textColor:\"primary\",variant:\"scrollable\",scrollButtons:\"auto\",children:[/*#__PURE__*/_jsx(Tab,{label:\"All\"}),/*#__PURE__*/_jsx(Tab,{label:/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",children:[\"Unread\",unreadCount>0&&/*#__PURE__*/_jsx(Chip,{label:unreadCount,color:\"error\",size:\"small\",sx:{ml:1}})]})}),/*#__PURE__*/_jsx(Tab,{label:\"Events\"}),/*#__PURE__*/_jsx(Tab,{label:\"Orders\"}),/*#__PURE__*/_jsx(Tab,{label:\"Messages\"})]}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:0,children:/*#__PURE__*/_jsx(NotificationList,{notifications:filteredNotifications,handleMenuClick:handleMenuClick,handleNotificationClick:handleNotificationClick,getNotificationIcon:getNotificationIcon})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:1,children:/*#__PURE__*/_jsx(NotificationList,{notifications:filteredNotifications,handleMenuClick:handleMenuClick,handleNotificationClick:handleNotificationClick,getNotificationIcon:getNotificationIcon,emptyMessage:\"No unread notifications\"})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:2,children:/*#__PURE__*/_jsx(NotificationList,{notifications:filteredNotifications,handleMenuClick:handleMenuClick,handleNotificationClick:handleNotificationClick,getNotificationIcon:getNotificationIcon,emptyMessage:\"No event notifications\"})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:3,children:/*#__PURE__*/_jsx(NotificationList,{notifications:filteredNotifications,handleMenuClick:handleMenuClick,handleNotificationClick:handleNotificationClick,getNotificationIcon:getNotificationIcon,emptyMessage:\"No order notifications\"})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:4,children:/*#__PURE__*/_jsx(NotificationList,{notifications:filteredNotifications,handleMenuClick:handleMenuClick,handleNotificationClick:handleNotificationClick,getNotificationIcon:getNotificationIcon,emptyMessage:\"No message notifications\"})})]})]}),/*#__PURE__*/_jsxs(Menu,{anchorEl:anchorEl,open:Boolean(anchorEl),onClose:handleMenuClose,children:[/*#__PURE__*/_jsx(MenuItem,{onClick:handleMarkAsRead,children:\"Mark as Read\"}),/*#__PURE__*/_jsx(MenuItem,{onClick:handleDeleteNotification,children:\"Delete\"})]})]});};// Helper component for notification list\nconst NotificationList=_ref=>{let{notifications,handleMenuClick,handleNotificationClick,getNotificationIcon,emptyMessage=\"No notifications\"}=_ref;if(notifications.length===0){return/*#__PURE__*/_jsx(Box,{textAlign:\"center\",py:3,children:/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:emptyMessage})});}const formatTime=dateString=>{const date=new Date(dateString);const now=new Date();const diffMinutes=Math.floor((now-date)/(1000*60));if(diffMinutes<1)return'Just now';if(diffMinutes<60)return`${diffMinutes}m ago`;const diffHours=Math.floor(diffMinutes/60);if(diffHours<24)return`${diffHours}h ago`;const diffDays=Math.floor(diffHours/24);if(diffDays<7)return`${diffDays}d ago`;return date.toLocaleDateString();};return/*#__PURE__*/_jsx(List,{sx:{width:'100%',bgcolor:'background.paper'},children:notifications.map(notification=>/*#__PURE__*/_jsx(Paper,{elevation:notification.read?0:1,sx:{mb:1,bgcolor:notification.read?'background.paper':'action.hover'},children:/*#__PURE__*/_jsxs(ListItem,{alignItems:\"flex-start\",button:true,onClick:()=>handleNotificationClick(notification),sx:{py:2},children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:notification.read?'action.disabledBackground':'primary.light'},children:getNotificationIcon(notification.type)})}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",component:\"span\",fontWeight:notification.read?'normal':'bold',children:notification.title}),!notification.read&&/*#__PURE__*/_jsx(Chip,{label:\"New\",size:\"small\",color:\"primary\",sx:{ml:1,height:20}})]}),secondary:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{component:\"span\",variant:\"body2\",color:\"text.primary\",sx:{display:'block',mb:1},children:notification.message}),/*#__PURE__*/_jsx(Typography,{component:\"span\",variant:\"caption\",color:\"text.secondary\",children:formatTime(notification.createdAt)})]})}),/*#__PURE__*/_jsx(ListItemSecondaryAction,{children:/*#__PURE__*/_jsx(IconButton,{edge:\"end\",onClick:e=>handleMenuClick(e,notification._id),children:/*#__PURE__*/_jsx(MoreVert,{})})})]})},notification._id))});};export default NotificationScreen;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}