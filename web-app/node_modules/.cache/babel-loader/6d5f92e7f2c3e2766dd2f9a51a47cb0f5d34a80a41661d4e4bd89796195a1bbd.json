{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Row,Col,Card,Typography,Button,Space,Steps,Form,Input,Select,InputNumber,Radio,Checkbox,Divider,Alert,Modal,Spin,Result,Tag,Avatar,Descriptions}from'antd';import{CalendarOutlined,EnvironmentOutlined,UserOutlined,DollarOutlined,CreditCardOutlined,SafetyCertificateOutlined,CheckCircleOutlined,ExclamationCircleOutlined,ArrowLeftOutlined,TagOutlined,MailOutlined,PhoneOutlined}from'@ant-design/icons';import{useParams,useNavigate}from'react-router-dom';import{useAuth}from'../../contexts/AuthContext';import{useNotification}from'../../contexts/NotificationContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Title,Text,Paragraph}=Typography;const{Option}=Select;const{Step}=Steps;const{TextArea}=Input;const TicketBookingScreen=()=>{var _user$displayName,_user$displayName2;const{eventId}=useParams();const[currentStep,setCurrentStep]=useState(0);const[form]=Form.useForm();const[loading,setLoading]=useState(true);const[processing,setProcessing]=useState(false);const[event,setEvent]=useState(null);const[ticketQuantity,setTicketQuantity]=useState(1);const[selectedTicketType,setSelectedTicketType]=useState('regular');const[paymentMethod,setPaymentMethod]=useState('card');const[bookingComplete,setBookingComplete]=useState(false);const[bookingDetails,setBookingDetails]=useState(null);const{user}=useAuth();const{showSuccess,showError,showWarning}=useNotification();const navigate=useNavigate();useEffect(()=>{if(!user){showWarning('Please login to book tickets');navigate('/login');return;}fetchEventDetails();},[eventId,user,navigate]);const fetchEventDetails=async()=>{try{setLoading(true);// Simulate API call\nsetTimeout(()=>{const mockEvent={id:eventId,title:'Annual Tech Conference 2024',description:'Join us for the biggest tech conference of the year featuring industry leaders.',category:'conference',location:'San Francisco Convention Center, 747 Howard St, San Francisco, CA 94103',date:'2024-03-15',time:'09:00',endTime:'18:00',organizer:{name:'Tech Events Inc.',email:'info@techevents.com',phone:'+1 (555) 123-4567',avatar:'/api/placeholder/40/40'},ticketTypes:[{id:'early-bird',name:'Early Bird',price:120,originalPrice:150,available:50,description:'Limited time offer with 20% discount',features:['All sessions access','Lunch included','Networking events','Conference materials']},{id:'regular',name:'Regular Ticket',price:150,available:200,description:'Standard conference ticket',features:['All sessions access','Lunch included','Networking events','Conference materials']},{id:'vip',name:'VIP Pass',price:300,available:25,description:'Premium experience with exclusive perks',features:['All sessions access','Premium lunch','VIP networking','Conference materials','Meet & greet with speakers','Priority seating']}],maxTicketsPerUser:5,refundPolicy:'Full refund up to 48 hours before event',terms:'By booking this ticket, you agree to our terms and conditions.',image:'/api/placeholder/400/200'};setEvent(mockEvent);setLoading(false);},1000);}catch(error){showError('Failed to load event details');setLoading(false);}};const handleStepChange=step=>{if(step<currentStep){setCurrentStep(step);}else if(step===currentStep+1){validateCurrentStep().then(()=>{setCurrentStep(step);}).catch(()=>{showError('Please complete the current step before proceeding');});}};const validateCurrentStep=()=>{switch(currentStep){case 0:return Promise.resolve(ticketQuantity>0&&selectedTicketType);case 1:return form.validateFields(['firstName','lastName','email','phone']);case 2:return form.validateFields(['paymentMethod']);default:return Promise.resolve(true);}};const calculateTotal=()=>{const selectedTicket=event===null||event===void 0?void 0:event.ticketTypes.find(t=>t.id===selectedTicketType);if(!selectedTicket)return 0;const subtotal=selectedTicket.price*ticketQuantity;const processingFee=subtotal*0.029;// 2.9% processing fee\nconst tax=subtotal*0.0875;// 8.75% tax\nreturn{subtotal,processingFee,tax,total:subtotal+processingFee+tax};};const handleBooking=async values=>{try{setProcessing(true);// Simulate payment processing\nsetTimeout(()=>{const booking={id:`booking-${Date.now()}`,eventId:event.id,eventTitle:event.title,ticketType:selectedTicketType,quantity:ticketQuantity,attendeeInfo:values,paymentMethod:values.paymentMethod,total:calculateTotal().total,bookingDate:new Date().toISOString(),status:'confirmed',qrCode:`qr-${Date.now()}`,tickets:Array.from({length:ticketQuantity},(_,i)=>({id:`ticket-${Date.now()}-${i}`,number:`TCK${Date.now()}${i}`,valid:true}))};setBookingDetails(booking);setBookingComplete(true);setProcessing(false);showSuccess('Booking confirmed successfully!');},3000);}catch(error){showError('Booking failed. Please try again.');setProcessing(false);}};const formatPrice=price=>`$${price.toFixed(2)}`;const formatDate=date=>{return new Date(date).toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});};if(loading){return/*#__PURE__*/_jsxs(\"div\",{style:{padding:24,textAlign:'center'},children:[/*#__PURE__*/_jsx(Spin,{size:\"large\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:16},children:/*#__PURE__*/_jsx(Text,{children:\"Loading event details...\"})})]});}if(!event){return/*#__PURE__*/_jsx(\"div\",{style:{padding:24,textAlign:'center'},children:/*#__PURE__*/_jsx(Result,{status:\"404\",title:\"Event Not Found\",subTitle:\"The event you're trying to book doesn't exist or is no longer available.\",extra:/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>navigate('/events'),children:\"Browse Events\"})})});}if(bookingComplete&&bookingDetails){return/*#__PURE__*/_jsx(\"div\",{style:{padding:24,background:'#f5f5f5',minHeight:'100vh'},children:/*#__PURE__*/_jsx(Row,{justify:\"center\",children:/*#__PURE__*/_jsxs(Col,{xs:24,lg:16,xl:12,children:[/*#__PURE__*/_jsx(Result,{status:\"success\",title:\"Booking Confirmed!\",subTitle:`Your tickets for ${event.title} have been successfully booked.`,extra:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>navigate('/profile/bookings'),children:\"View My Tickets\"},\"tickets\"),/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/events'),children:\"Browse More Events\"},\"events\")]}),/*#__PURE__*/_jsxs(Card,{title:\"Booking Details\",style:{marginTop:24},children:[/*#__PURE__*/_jsxs(Descriptions,{column:1,bordered:true,children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:\"Booking ID\",children:bookingDetails.id}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"Event\",children:bookingDetails.eventTitle}),/*#__PURE__*/_jsxs(Descriptions.Item,{label:\"Date\",children:[formatDate(event.date),\" at \",event.time]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"Location\",children:event.location}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"Ticket Type\",children:selectedTicketType}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"Quantity\",children:bookingDetails.quantity}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"Total Paid\",children:formatPrice(bookingDetails.total)}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"Status\",children:/*#__PURE__*/_jsx(Tag,{color:\"green\",children:\"Confirmed\"})})]}),/*#__PURE__*/_jsx(Alert,{message:\"Important Information\",description:\"A confirmation email has been sent to your registered email address. Please bring a valid ID and your ticket confirmation to the event.\",type:\"info\",showIcon:true,style:{marginTop:16}})]})]})})});}const steps=[{title:'Select Tickets',icon:/*#__PURE__*/_jsx(TagOutlined,{})},{title:'Attendee Info',icon:/*#__PURE__*/_jsx(UserOutlined,{})},{title:'Payment',icon:/*#__PURE__*/_jsx(CreditCardOutlined,{})},{title:'Confirmation',icon:/*#__PURE__*/_jsx(CheckCircleOutlined,{})}];const renderTicketSelection=()=>/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",style:{width:'100%'},size:\"large\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"Select Ticket Type\"}),/*#__PURE__*/_jsx(Radio.Group,{value:selectedTicketType,onChange:e=>setSelectedTicketType(e.target.value),style:{width:'100%'},children:/*#__PURE__*/_jsx(Space,{direction:\"vertical\",style:{width:'100%'},size:\"middle\",children:event.ticketTypes.map(ticket=>/*#__PURE__*/_jsxs(Card,{style:{border:selectedTicketType===ticket.id?'2px solid #1890ff':'1px solid #f0f0f0',cursor:'pointer'},onClick:()=>setSelectedTicketType(ticket.id),children:[/*#__PURE__*/_jsx(Radio,{value:ticket.id,style:{marginBottom:8},children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",size:4,children:[/*#__PURE__*/_jsx(Text,{strong:true,style:{fontSize:16},children:ticket.name}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Text,{strong:true,style:{fontSize:18,color:'#52c41a'},children:formatPrice(ticket.price)}),ticket.originalPrice&&/*#__PURE__*/_jsx(Text,{delete:true,type:\"secondary\",children:formatPrice(ticket.originalPrice)})]}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:ticket.description}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[\"Available: \",ticket.available]})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8},children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Features:\"}),/*#__PURE__*/_jsx(\"ul\",{style:{margin:'4px 0',paddingLeft:20},children:ticket.features.map((feature,index)=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:feature})},index))})]})]},ticket.id))})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"Quantity\"}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Text,{children:\"Number of tickets:\"}),/*#__PURE__*/_jsx(InputNumber,{min:1,max:event.maxTicketsPerUser,value:ticketQuantity,onChange:setTicketQuantity,size:\"large\"}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[\"(Max \",event.maxTicketsPerUser,\" per person)\"]})]})]})]});const renderAttendeeInfo=()=>/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",style:{width:'100%'},size:\"large\",children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"Attendee Information\"}),/*#__PURE__*/_jsx(Form.Item,{name:\"firstName\",label:\"First Name\",rules:[{required:true,message:'Please enter first name'}],children:/*#__PURE__*/_jsx(Input,{size:\"large\",placeholder:\"Enter first name\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"lastName\",label:\"Last Name\",rules:[{required:true,message:'Please enter last name'}],children:/*#__PURE__*/_jsx(Input,{size:\"large\",placeholder:\"Enter last name\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"email\",label:\"Email\",rules:[{required:true,message:'Please enter email'},{type:'email',message:'Please enter valid email'}],children:/*#__PURE__*/_jsx(Input,{size:\"large\",placeholder:\"Enter email address\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"phone\",label:\"Phone Number\",rules:[{required:true,message:'Please enter phone number'}],children:/*#__PURE__*/_jsx(Input,{size:\"large\",placeholder:\"Enter phone number\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"organization\",label:\"Organization (Optional)\",children:/*#__PURE__*/_jsx(Input,{size:\"large\",placeholder:\"Company or organization name\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"specialRequests\",label:\"Special Requests (Optional)\",children:/*#__PURE__*/_jsx(TextArea,{rows:3,placeholder:\"Dietary restrictions, accessibility needs, etc.\"})})]});const renderPayment=()=>{const pricing=calculateTotal();return/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",style:{width:'100%'},size:\"large\",children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"Payment Information\"}),/*#__PURE__*/_jsx(Card,{title:\"Order Summary\",style:{marginBottom:16},children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",style:{width:'100%'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(Text,{children:[ticketQuantity,\"x \",selectedTicketType,\" ticket(s)\"]}),/*#__PURE__*/_jsx(Text,{children:formatPrice(pricing.subtotal)})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Processing fee (2.9%)\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:formatPrice(pricing.processingFee)})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Tax (8.75%)\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:formatPrice(pricing.tax)})]}),/*#__PURE__*/_jsx(Divider,{style:{margin:'8px 0'}}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Text,{strong:true,style:{fontSize:16},children:\"Total\"}),/*#__PURE__*/_jsx(Text,{strong:true,style:{fontSize:18,color:'#52c41a'},children:formatPrice(pricing.total)})]})]})}),/*#__PURE__*/_jsx(Form.Item,{name:\"paymentMethod\",label:\"Payment Method\",rules:[{required:true,message:'Please select payment method'}],children:/*#__PURE__*/_jsx(Radio.Group,{children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",children:[/*#__PURE__*/_jsx(Radio,{value:\"card\",children:\"Credit/Debit Card\"}),/*#__PURE__*/_jsx(Radio,{value:\"paypal\",children:\"PayPal\"}),/*#__PURE__*/_jsx(Radio,{value:\"apple-pay\",children:\"Apple Pay\"}),/*#__PURE__*/_jsx(Radio,{value:\"google-pay\",children:\"Google Pay\"})]})})}),/*#__PURE__*/_jsx(Form.Item,{dependencies:['paymentMethod'],noStyle:true,children:_ref=>{let{getFieldValue}=_ref;const method=getFieldValue('paymentMethod');if(method==='card'){return/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",style:{width:'100%'},children:[/*#__PURE__*/_jsx(Form.Item,{name:\"cardNumber\",label:\"Card Number\",rules:[{required:true,message:'Please enter card number'}],children:/*#__PURE__*/_jsx(Input,{size:\"large\",placeholder:\"1234 5678 9012 3456\",prefix:/*#__PURE__*/_jsx(CreditCardOutlined,{})})}),/*#__PURE__*/_jsxs(Row,{gutter:16,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"expiryDate\",label:\"Expiry Date\",rules:[{required:true,message:'Please enter expiry date'}],children:/*#__PURE__*/_jsx(Input,{size:\"large\",placeholder:\"MM/YY\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"cvv\",label:\"CVV\",rules:[{required:true,message:'Please enter CVV'}],children:/*#__PURE__*/_jsx(Input,{size:\"large\",placeholder:\"123\"})})})]}),/*#__PURE__*/_jsx(Form.Item,{name:\"cardholderName\",label:\"Cardholder Name\",rules:[{required:true,message:'Please enter cardholder name'}],children:/*#__PURE__*/_jsx(Input,{size:\"large\",placeholder:\"Name on card\"})})]});}return null;}}),/*#__PURE__*/_jsx(Form.Item,{name:\"agreeTerms\",valuePropName:\"checked\",rules:[{required:true,message:'Please agree to terms and conditions'}],children:/*#__PURE__*/_jsxs(Checkbox,{children:[\"I agree to the \",/*#__PURE__*/_jsx(\"a\",{href:\"/terms\",target:\"_blank\",children:\"terms and conditions\"}),\" and\",' ',/*#__PURE__*/_jsx(\"a\",{href:\"/refund-policy\",target:\"_blank\",children:\"refund policy\"})]})}),/*#__PURE__*/_jsx(Alert,{message:\"Secure Payment\",description:\"Your payment information is encrypted and secure. We never store your card details.\",type:\"info\",showIcon:true,icon:/*#__PURE__*/_jsx(SafetyCertificateOutlined,{})})]});};return/*#__PURE__*/_jsx(\"div\",{style:{padding:24,background:'#f5f5f5',minHeight:'100vh'},children:/*#__PURE__*/_jsx(Row,{justify:\"center\",children:/*#__PURE__*/_jsxs(Col,{xs:24,lg:20,xl:16,children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:24},children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(ArrowLeftOutlined,{}),onClick:()=>navigate(`/events/${eventId}`),children:\"Back to Event\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Title,{level:2,style:{margin:0},children:\"Book Tickets\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:event.title})]})]})}),/*#__PURE__*/_jsx(Card,{style:{marginBottom:24},children:/*#__PURE__*/_jsxs(Row,{gutter:16,align:\"middle\",children:[/*#__PURE__*/_jsx(Col,{xs:24,md:18,children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",size:4,children:[/*#__PURE__*/_jsx(Title,{level:4,style:{margin:0},children:event.title}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(CalendarOutlined,{}),/*#__PURE__*/_jsxs(Text,{children:[formatDate(event.date),\" at \",event.time]})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(EnvironmentOutlined,{}),/*#__PURE__*/_jsx(Text,{children:event.location})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(UserOutlined,{}),/*#__PURE__*/_jsxs(Text,{children:[\"Organized by \",event.organizer.name]})]})]})}),/*#__PURE__*/_jsx(Col,{xs:24,md:6,children:/*#__PURE__*/_jsx(\"div\",{style:{height:100,background:'#f0f0f0',borderRadius:8,display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Event Image\"})})})]})}),/*#__PURE__*/_jsx(Card,{style:{marginBottom:24},children:/*#__PURE__*/_jsx(Steps,{current:currentStep,onChange:handleStepChange,children:steps.map((step,index)=>/*#__PURE__*/_jsx(Step,{title:step.title,icon:step.icon},index))})}),/*#__PURE__*/_jsxs(Form,{form:form,layout:\"vertical\",onFinish:handleBooking,size:\"large\",initialValues:{firstName:(user===null||user===void 0?void 0:(_user$displayName=user.displayName)===null||_user$displayName===void 0?void 0:_user$displayName.split(' ')[0])||'',lastName:(user===null||user===void 0?void 0:(_user$displayName2=user.displayName)===null||_user$displayName2===void 0?void 0:_user$displayName2.split(' ')[1])||'',email:(user===null||user===void 0?void 0:user.email)||''},children:[/*#__PURE__*/_jsxs(Card,{children:[currentStep===0&&renderTicketSelection(),currentStep===1&&renderAttendeeInfo(),currentStep===2&&renderPayment(),currentStep===3&&/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'40px 0'},children:[/*#__PURE__*/_jsx(Spin,{size:\"large\",spinning:processing}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:16},children:/*#__PURE__*/_jsx(Text,{children:processing?'Processing your booking...':'Ready to confirm'})})]})]}),/*#__PURE__*/_jsx(Card,{style:{marginTop:16},children:/*#__PURE__*/_jsxs(Row,{justify:\"space-between\",children:[/*#__PURE__*/_jsx(Col,{children:currentStep>0&&/*#__PURE__*/_jsx(Button,{size:\"large\",onClick:()=>setCurrentStep(currentStep-1),children:\"Previous\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{size:\"large\",onClick:()=>navigate(`/events/${eventId}`),children:\"Cancel\"}),currentStep<steps.length-1?/*#__PURE__*/_jsx(Button,{type:\"primary\",size:\"large\",onClick:()=>{validateCurrentStep().then(()=>{setCurrentStep(currentStep+1);}).catch(()=>{showError('Please complete all required fields');});},children:\"Continue\"}):/*#__PURE__*/_jsx(Button,{type:\"primary\",size:\"large\",htmlType:\"submit\",loading:processing,disabled:processing,children:processing?'Processing...':'Confirm Booking'})]})})]})})]})]})})});};export default TicketBookingScreen;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}