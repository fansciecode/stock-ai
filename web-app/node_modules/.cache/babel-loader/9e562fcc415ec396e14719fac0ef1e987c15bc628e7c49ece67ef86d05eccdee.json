{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import'./Home.css';// Services\nimport EventService from'../../services/EventService';import CategoryService from'../../services/CategoryService';import{useAuth}from'../../contexts/AuthContext';// Components\nimport EventCard from'../../components/EventCard';import CategoryItem from'../../components/CategoryItem';import MapView from'../../components/MapView';import SearchBar from'../../components/SearchBar';import LoadingSpinner from'../../components/LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Home=()=>{// Navigation\nconst navigate=useNavigate();const{isAuthenticated,user}=useAuth();// State\nconst[events,setEvents]=useState([]);const[filteredEvents,setFilteredEvents]=useState([]);const[categories,setCategories]=useState([]);const[selectedCategories,setSelectedCategories]=useState([]);const[userLocation,setUserLocation]=useState(null);const[isLoading,setIsLoading]=useState(false);const[errorMessage,setErrorMessage]=useState(null);const[isMapView,setIsMapView]=useState(false);const[showCategoriesAsGrid,setShowCategoriesAsGrid]=useState(false);const[searchQuery,setSearchQuery]=useState('');// Modals\nconst[showLoginPrompt,setShowLoginPrompt]=useState(false);const[showVerificationPrompt,setShowVerificationPrompt]=useState(false);const[showCategorySelectionPrompt,setShowCategorySelectionPrompt]=useState(false);const[showLocationPrompt,setShowLocationPrompt]=useState(false);// Services\nconst eventService=new EventService();const categoryService=new CategoryService();// Effects\nuseEffect(()=>{loadInitialData();checkLocationPermission();},[]);useEffect(()=>{updateFilteredEvents();},[events,selectedCategories,searchQuery]);// Functions\nconst loadInitialData=async()=>{setIsLoading(true);setErrorMessage(null);try{// Load categories\nconst categoriesData=await categoryService.getCategories();setCategories(categoriesData);// Load events\nconst eventsData=await eventService.getEvents();setEvents(eventsData);setFilteredEvents(eventsData);}catch(error){setErrorMessage('Failed to load data. Please try again.');console.error('Error loading data:',error);}finally{setIsLoading(false);}};const checkLocationPermission=()=>{if(navigator.geolocation){navigator.geolocation.getCurrentPosition(position=>{const{latitude,longitude}=position.coords;setUserLocation({latitude,longitude});calculateEventDistances({latitude,longitude});},error=>{console.error('Error getting location:',error);setShowLocationPrompt(true);});}else{setErrorMessage('Geolocation is not supported by this browser.');}};const calculateEventDistances=location=>{if(!location||events.length===0)return;const eventsWithDistance=events.map(event=>{if(event.location&&event.location.coordinates){const distance=getDistanceFromLatLonInKm(location.latitude,location.longitude,event.location.coordinates[1],event.location.coordinates[0]);return{...event,distance};}return event;});// Sort events by distance\neventsWithDistance.sort((a,b)=>(a.distance||Infinity)-(b.distance||Infinity));setEvents(eventsWithDistance);};const updateFilteredEvents=()=>{let filtered=[...events];// Filter by selected categories\nif(selectedCategories.length>0){filtered=filtered.filter(event=>event.category&&selectedCategories.some(cat=>cat.id===event.category.id));}// Filter by search query\nif(searchQuery){const query=searchQuery.toLowerCase();filtered=filtered.filter(event=>{var _event$location;return event.title.toLowerCase().includes(query)||event.description.toLowerCase().includes(query)||((_event$location=event.location)===null||_event$location===void 0?void 0:_event$location.address)&&event.location.address.toLowerCase().includes(query);});}setFilteredEvents(filtered);};const handleCategorySelect=category=>{setSelectedCategories(prev=>{const isSelected=prev.some(cat=>cat.id===category.id);if(isSelected){return prev.filter(cat=>cat.id!==category.id);}else{return[...prev,category];}});};const handleSearch=query=>{setSearchQuery(query);};const handleEventSelect=eventId=>{navigate(`/events/${eventId}`);};const handleCreateEventClick=()=>{if(!isAuthenticated){setShowLoginPrompt(true);return;}navigate('/create-event');};const handleNotificationClick=()=>{if(!isAuthenticated){setShowLoginPrompt(true);return;}navigate('/notifications');};const handleProfileClick=()=>{if(!isAuthenticated){setShowLoginPrompt(true);return;}navigate('/profile');};const handleBrowseEventsClick=()=>{navigate('/browse-events');};// Helper function to calculate distance\nconst getDistanceFromLatLonInKm=(lat1,lon1,lat2,lon2)=>{const R=6371;// Radius of the earth in km\nconst dLat=deg2rad(lat2-lat1);const dLon=deg2rad(lon2-lon1);const a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(deg2rad(lat1))*Math.cos(deg2rad(lat2))*Math.sin(dLon/2)*Math.sin(dLon/2);const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));const d=R*c;// Distance in km\nreturn d*1000;// Convert to meters\n};const deg2rad=deg=>{return deg*(Math.PI/180);};const formatDistance=meters=>{if(meters<1000){return`${Math.round(meters)}m`;}else{return`${(meters/1000).toFixed(1)}km`;}};// Render\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"home-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"top-bar\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"app-title\",children:\"IBCM\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"top-bar-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"icon-button\",onClick:handleNotificationClick,\"aria-label\":\"Notifications\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-bell\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"icon-button\",onClick:handleProfileClick,\"aria-label\":\"Profile\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-user-circle\"})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"search-container\",children:/*#__PURE__*/_jsx(SearchBar,{onSearch:handleSearch})}),/*#__PURE__*/_jsxs(\"div\",{className:\"categories-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Categories\"}),/*#__PURE__*/_jsx(\"button\",{className:\"view-toggle-button\",onClick:()=>setShowCategoriesAsGrid(!showCategoriesAsGrid),children:showCategoriesAsGrid?'Show as Row':'Show as Grid'})]}),/*#__PURE__*/_jsx(\"div\",{className:`categories-container ${showCategoriesAsGrid?'grid-view':'row-view'}`,children:categories.map(category=>/*#__PURE__*/_jsx(CategoryItem,{category:category,isSelected:selectedCategories.some(cat=>cat.id===category.id),onClick:()=>handleCategorySelect(category)},category.id))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"events-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Events Near You\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"view-toggle-button\",onClick:()=>setIsMapView(!isMapView),children:[/*#__PURE__*/_jsx(\"i\",{className:`fas ${isMapView?'fa-list':'fa-map-marker-alt'}`}),isMapView?' List View':' Map View']})]}),isLoading?/*#__PURE__*/_jsx(LoadingSpinner,{}):errorMessage?/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:errorMessage}):isMapView?/*#__PURE__*/_jsx(\"div\",{className:\"map-container\",children:/*#__PURE__*/_jsx(MapView,{events:filteredEvents,userLocation:userLocation,onEventSelect:handleEventSelect})}):/*#__PURE__*/_jsx(\"div\",{className:\"events-list\",children:filteredEvents.length>0?filteredEvents.map(event=>/*#__PURE__*/_jsx(EventCard,{event:event,onClick:()=>handleEventSelect(event.id),distance:event.distance?formatDistance(event.distance):null},event.id)):/*#__PURE__*/_jsxs(\"div\",{className:\"no-events-message\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-calendar-times\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"No events found\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Try changing your filters or location\"}),/*#__PURE__*/_jsx(\"button\",{className:\"primary-button\",onClick:handleBrowseEventsClick,children:\"Browse All Events\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"quick-actions\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"action-button\",onClick:handleCreateEventClick,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-plus-circle\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Create Event\"})]})}),showLoginPrompt&&/*#__PURE__*/_jsx(\"div\",{className:\"modal\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Login Required\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please login or sign up to continue\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"primary-button\",onClick:()=>navigate('/login'),children:\"Login\"}),/*#__PURE__*/_jsx(\"button\",{className:\"secondary-button\",onClick:()=>navigate('/signup'),children:\"Sign Up\"}),/*#__PURE__*/_jsx(\"button\",{className:\"text-button\",onClick:()=>setShowLoginPrompt(false),children:\"Cancel\"})]})]})}),showLocationPrompt&&/*#__PURE__*/_jsx(\"div\",{className:\"modal\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Enable Location Services\"}),/*#__PURE__*/_jsx(\"p\",{children:\"To show events near you, please enable location services\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"primary-button\",onClick:()=>{setShowLocationPrompt(false);// This doesn't actually open settings in a browser, but it's the equivalent action\nalert('Please enable location services in your browser settings');},children:\"Settings\"}),/*#__PURE__*/_jsx(\"button\",{className:\"text-button\",onClick:()=>setShowLocationPrompt(false),children:\"Cancel\"})]})]})})]});};export default Home;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}