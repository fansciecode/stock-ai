{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{Layout,Card,Input,Button,List,Avatar,Typography,Space,Badge,Divider,Dropdown,Menu,Empty,Spin,Upload,Emoji,Tooltip,Modal,Row,Col}from'antd';import{SendOutlined,PaperClipOutlined,SmileOutlined,MoreOutlined,SearchOutlined,PhoneOutlined,VideoCameraOutlined,InfoCircleOutlined,DeleteOutlined,FileOutlined,PictureOutlined,SoundOutlined}from'@ant-design/icons';import{useParams,useNavigate}from'react-router-dom';import{useAuth}from'../../contexts/AuthContext';import{useNotification}from'../../contexts/NotificationContext';import'./ChatScreen.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const{Header,Content,Sider}=Layout;const{Title,Text}=Typography;const{Search}=Input;const ChatScreen=()=>{const{chatId}=useParams();const[loading,setLoading]=useState(true);const[messageLoading,setMessageLoading]=useState(false);const[conversations,setConversations]=useState([]);const[selectedChat,setSelectedChat]=useState(null);const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[searchQuery,setSearchQuery]=useState('');const[sidebarVisible,setSidebarVisible]=useState(true);const[chatInfoVisible,setChatInfoVisible]=useState(false);const[typing,setTyping]=useState(false);const[onlineUsers,setOnlineUsers]=useState([]);const messagesEndRef=useRef(null);const fileInputRef=useRef(null);const{user}=useAuth();const{showSuccess,showError}=useNotification();const navigate=useNavigate();useEffect(()=>{loadConversations();if(chatId){loadChatMessages(chatId);}},[chatId]);useEffect(()=>{scrollToBottom();},[messages]);const loadConversations=async()=>{try{setLoading(true);// Mock data - replace with actual API call\nconst mockConversations=[{id:1,name:'John Doe',avatar:'/api/placeholder/40/40',lastMessage:'Thanks for the event details!',lastMessageTime:'2 min ago',unreadCount:2,isOnline:true,type:'direct'},{id:2,name:'Tech Conference 2024',avatar:'/api/placeholder/40/40',lastMessage:'Sarah: Looking forward to the event',lastMessageTime:'1 hour ago',unreadCount:0,isOnline:false,type:'group',membersCount:15},{id:3,name:'Event Organizers',avatar:'/api/placeholder/40/40',lastMessage:'Mike: Let\\'s discuss the schedule',lastMessageTime:'3 hours ago',unreadCount:1,isOnline:false,type:'group',membersCount:8},{id:4,name:'Jane Smith',avatar:'/api/placeholder/40/40',lastMessage:'Could you send me the presentation?',lastMessageTime:'1 day ago',unreadCount:0,isOnline:true,type:'direct'}];setConversations(mockConversations);// Set selected chat if chatId is provided\nif(chatId){const chat=mockConversations.find(c=>c.id===parseInt(chatId));setSelectedChat(chat);}else if(mockConversations.length>0){setSelectedChat(mockConversations[0]);}}catch(error){console.error('Error loading conversations:',error);showError('Error','Failed to load conversations');}finally{setLoading(false);}};const loadChatMessages=async chatId=>{try{setMessageLoading(true);// Mock messages data\nconst mockMessages=[{id:1,senderId:2,senderName:'John Doe',senderAvatar:'/api/placeholder/32/32',message:'Hey! How are you doing?',timestamp:'2024-01-25T10:30:00Z',type:'text'},{id:2,senderId:(user===null||user===void 0?void 0:user.id)||1,senderName:(user===null||user===void 0?void 0:user.name)||'You',senderAvatar:(user===null||user===void 0?void 0:user.avatar)||'/api/placeholder/32/32',message:'I\\'m doing great! Thanks for asking. How about you?',timestamp:'2024-01-25T10:32:00Z',type:'text'},{id:3,senderId:2,senderName:'John Doe',senderAvatar:'/api/placeholder/32/32',message:'I\\'m excited about the upcoming tech conference!',timestamp:'2024-01-25T10:35:00Z',type:'text'},{id:4,senderId:(user===null||user===void 0?void 0:user.id)||1,senderName:(user===null||user===void 0?void 0:user.name)||'You',senderAvatar:(user===null||user===void 0?void 0:user.avatar)||'/api/placeholder/32/32',message:'Yes! It\\'s going to be amazing. Have you seen the agenda?',timestamp:'2024-01-25T10:37:00Z',type:'text'},{id:5,senderId:2,senderName:'John Doe',senderAvatar:'/api/placeholder/32/32',message:'Thanks for the event details!',timestamp:'2024-01-25T10:40:00Z',type:'text'}];setMessages(mockMessages);}catch(error){console.error('Error loading messages:',error);showError('Error','Failed to load messages');}finally{setMessageLoading(false);}};const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};const handleSendMessage=async()=>{if(!newMessage.trim()||!selectedChat)return;const messageData={id:messages.length+1,senderId:(user===null||user===void 0?void 0:user.id)||1,senderName:(user===null||user===void 0?void 0:user.name)||'You',senderAvatar:(user===null||user===void 0?void 0:user.avatar)||'/api/placeholder/32/32',message:newMessage,timestamp:new Date().toISOString(),type:'text'};setMessages([...messages,messageData]);setNewMessage('');// Update conversation last message\nconst updatedConversations=conversations.map(conv=>conv.id===selectedChat.id?{...conv,lastMessage:newMessage,lastMessageTime:'now'}:conv);setConversations(updatedConversations);try{// Send message to backend\n// await sendMessageAPI(selectedChat.id, newMessage);\n}catch(error){console.error('Error sending message:',error);showError('Error','Failed to send message');}};const handleKeyPress=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSendMessage();}};const handleFileUpload=file=>{// Handle file upload\nconsole.log('File uploaded:',file);return false;// Prevent default upload behavior\n};const handleChatSelect=chat=>{setSelectedChat(chat);if(chat.id!==parseInt(chatId)){navigate(`/chat/${chat.id}`);}loadChatMessages(chat.id);};const formatTime=timestamp=>{const date=new Date(timestamp);return date.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});};const isMyMessage=senderId=>{return senderId===((user===null||user===void 0?void 0:user.id)||1);};const renderMessage=message=>{const isOwn=isMyMessage(message.senderId);return/*#__PURE__*/_jsxs(\"div\",{className:`message ${isOwn?'message-own':'message-other'}`,children:[!isOwn&&/*#__PURE__*/_jsx(Avatar,{src:message.senderAvatar,size:32,className:\"message-avatar\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-content\",children:[!isOwn&&/*#__PURE__*/_jsx(Text,{className:\"message-sender\",children:message.senderName}),/*#__PURE__*/_jsx(\"div\",{className:`message-bubble ${isOwn?'message-bubble-own':'message-bubble-other'}`,children:/*#__PURE__*/_jsx(Text,{className:\"message-text\",children:message.message})}),/*#__PURE__*/_jsx(Text,{className:\"message-time\",children:formatTime(message.timestamp)})]})]},message.id);};const renderConversationItem=conversation=>/*#__PURE__*/_jsxs(\"div\",{className:`conversation-item ${(selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)===conversation.id?'conversation-selected':''}`,onClick:()=>handleChatSelect(conversation),children:[/*#__PURE__*/_jsx(\"div\",{className:\"conversation-avatar\",children:/*#__PURE__*/_jsx(Badge,{dot:conversation.isOnline,offset:[-8,8],children:/*#__PURE__*/_jsx(Avatar,{src:conversation.avatar,size:48})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"conversation-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"conversation-header\",children:[/*#__PURE__*/_jsx(Text,{className:\"conversation-name\",children:conversation.name}),/*#__PURE__*/_jsx(Text,{className:\"conversation-time\",children:conversation.lastMessageTime})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"conversation-message\",children:[/*#__PURE__*/_jsx(Text,{className:\"conversation-last-message\",ellipsis:true,children:conversation.lastMessage}),conversation.unreadCount>0&&/*#__PURE__*/_jsx(Badge,{count:conversation.unreadCount,size:\"small\"})]})]})]},conversation.id);const chatHeaderMenu=/*#__PURE__*/_jsx(Menu,{items:[{key:'info',icon:/*#__PURE__*/_jsx(InfoCircleOutlined,{}),label:'Chat Info',onClick:()=>setChatInfoVisible(true)},{key:'search',icon:/*#__PURE__*/_jsx(SearchOutlined,{}),label:'Search Messages'},{key:'delete',icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),label:'Delete Chat',danger:true}]});return/*#__PURE__*/_jsxs(Layout,{className:\"chat-layout\",children:[/*#__PURE__*/_jsxs(Sider,{width:320,theme:\"light\",className:\"chat-sidebar\",collapsible:false,collapsed:!sidebarVisible,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-sidebar-header\",children:[/*#__PURE__*/_jsx(Title,{level:4,className:\"chat-sidebar-title\",children:\"Messages\"}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(SearchOutlined,{}),className:\"chat-search-btn\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-sidebar-search\",children:/*#__PURE__*/_jsx(Search,{placeholder:\"Search conversations...\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value),className:\"conversation-search\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"conversations-list\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"chat-loading\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\"})}):conversations.length===0?/*#__PURE__*/_jsx(Empty,{description:\"No conversations yet\"}):conversations.filter(conv=>conv.name.toLowerCase().includes(searchQuery.toLowerCase())).map(renderConversationItem)})]}),/*#__PURE__*/_jsx(Layout,{className:\"chat-main\",children:selectedChat?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Header,{className:\"chat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header-info\",children:[/*#__PURE__*/_jsx(Avatar,{src:selectedChat.avatar,size:40}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header-text\",children:[/*#__PURE__*/_jsx(Title,{level:5,className:\"chat-header-name\",children:selectedChat.name}),/*#__PURE__*/_jsx(Text,{className:\"chat-header-status\",children:selectedChat.isOnline?'Online':'Last seen recently'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header-actions\",children:[/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(PhoneOutlined,{}),className:\"chat-action-btn\"}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(VideoCameraOutlined,{}),className:\"chat-action-btn\"}),/*#__PURE__*/_jsx(Dropdown,{overlay:chatHeaderMenu,trigger:['click'],children:/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(MoreOutlined,{}),className:\"chat-action-btn\"})})]})]}),/*#__PURE__*/_jsxs(Content,{className:\"chat-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"messages-container\",children:messageLoading?/*#__PURE__*/_jsx(\"div\",{className:\"chat-loading\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\"})}):messages.length===0?/*#__PURE__*/_jsx(Empty,{description:\"No messages yet\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"messages-list\",children:[messages.map(renderMessage),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"message-input-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"message-input-wrapper\",children:[/*#__PURE__*/_jsx(Upload,{beforeUpload:handleFileUpload,showUploadList:false,multiple:true,children:/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(PaperClipOutlined,{}),className:\"message-action-btn\"})}),/*#__PURE__*/_jsx(Input.TextArea,{value:newMessage,onChange:e=>setNewMessage(e.target.value),onKeyPress:handleKeyPress,placeholder:\"Type a message...\",className:\"message-input\",autoSize:{minRows:1,maxRows:4}}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(SmileOutlined,{}),className:\"message-action-btn\"}),/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(SendOutlined,{}),onClick:handleSendMessage,disabled:!newMessage.trim(),className:\"send-btn\"})]})})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"chat-empty\",children:/*#__PURE__*/_jsx(Empty,{description:\"Select a conversation to start messaging\",image:Empty.PRESENTED_IMAGE_SIMPLE})})}),/*#__PURE__*/_jsx(Modal,{title:\"Chat Information\",open:chatInfoVisible,onCancel:()=>setChatInfoVisible(false),footer:null,width:400,children:selectedChat&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-info-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-info-header\",children:[/*#__PURE__*/_jsx(Avatar,{src:selectedChat.avatar,size:64}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-info-details\",children:[/*#__PURE__*/_jsx(Title,{level:4,children:selectedChat.name}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:selectedChat.type==='group'?`${selectedChat.membersCount} members`:selectedChat.isOnline?'Online':'Last seen recently'})]})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-info-actions\",children:[/*#__PURE__*/_jsxs(Button,{block:true,className:\"chat-info-action\",children:[/*#__PURE__*/_jsx(SearchOutlined,{}),\" Search Messages\"]}),/*#__PURE__*/_jsxs(Button,{block:true,className:\"chat-info-action\",children:[/*#__PURE__*/_jsx(FileOutlined,{}),\" Shared Files\"]}),/*#__PURE__*/_jsxs(Button,{block:true,className:\"chat-info-action\",children:[/*#__PURE__*/_jsx(PictureOutlined,{}),\" Shared Photos\"]}),/*#__PURE__*/_jsxs(Button,{block:true,danger:true,className:\"chat-info-action\",children:[/*#__PURE__*/_jsx(DeleteOutlined,{}),\" Delete Chat\"]})]})]})})]});};export default ChatScreen;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}