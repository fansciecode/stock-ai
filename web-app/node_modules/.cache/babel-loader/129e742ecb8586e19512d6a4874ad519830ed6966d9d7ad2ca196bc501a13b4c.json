{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Card,Form,Input,Button,Steps,Typography,Row,Col,Divider,Alert,Radio,Checkbox,Select,Space,Spin,Result,Tag,Avatar,List,Modal,Tooltip}from'antd';import{CreditCardOutlined,BankOutlined,WalletOutlined,MobileOutlined,SafetyOutlined,CheckCircleOutlined,CloseCircleOutlined,InfoCircleOutlined,LeftOutlined,RightOutlined}from'@ant-design/icons';import{useParams,useNavigate}from'react-router-dom';import{useAuth}from'../../contexts/AuthContext';import{useNotification}from'../../contexts/NotificationContext';import'./PaymentScreen.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Title,Text,Paragraph}=Typography;const{Step}=Steps;const{Option}=Select;const PaymentScreen=()=>{const{eventId}=useParams();const[form]=Form.useForm();const[loading,setLoading]=useState(true);const[processing,setProcessing]=useState(false);const[currentStep,setCurrentStep]=useState(0);const[paymentMethod,setPaymentMethod]=useState('card');const[eventDetails,setEventDetails]=useState(null);const[orderSummary,setOrderSummary]=useState(null);const[paymentResult,setPaymentResult]=useState(null);const[promoCode,setPromoCode]=useState('');const[promoApplied,setPromoApplied]=useState(false);const[savedCards,setSavedCards]=useState([]);const[selectedCard,setSelectedCard]=useState(null);const[billingAddress,setBillingAddress]=useState(null);const[razorpayInstance,setRazorpayInstance]=useState(null);const{user}=useAuth();const{showSuccess,showError,showInfo}=useNotification();const navigate=useNavigate();useEffect(()=>{loadEventDetails();loadSavedCards();loadRazorpayScript();},[eventId]);const loadRazorpayScript=()=>{const script=document.createElement('script');script.src='https://checkout.razorpay.com/v1/checkout.js';script.onload=()=>{console.log('Razorpay script loaded successfully');};script.onerror=()=>{showError('Error','Failed to load payment gateway');};document.body.appendChild(script);};const loadEventDetails=async()=>{try{setLoading(true);// Mock event details - replace with actual API call\nconst mockEventDetails={id:eventId,title:'Tech Innovation Summit 2024',description:'The biggest tech conference of the year',date:'2024-03-15',time:'09:00 AM',location:'San Francisco Convention Center',image:'/api/placeholder/400/300',organizer:'TechCorp',category:'Technology',packages:[{id:1,name:'Basic',price:99,features:['Event Access','Welcome Kit','Networking Lunch'],recommended:false},{id:2,name:'Premium',price:199,features:['Event Access','Welcome Kit','Networking Lunch','Workshop Access','Premium Seating'],recommended:true},{id:3,name:'VIP',price:299,features:['Event Access','Welcome Kit','Networking Lunch','Workshop Access','VIP Seating','Meet & Greet'],recommended:false}]};setEventDetails(mockEventDetails);// Set default order summary\nsetOrderSummary({selectedPackage:mockEventDetails.packages[1],// Premium package\nquantity:1,subtotal:199,tax:35.82,processingFee:4.99,discount:0,total:239.81});}catch(error){console.error('Error loading event details:',error);showError('Error','Failed to load event details');}finally{setLoading(false);}};const loadSavedCards=async()=>{try{// Mock saved cards - replace with actual API call\nconst mockSavedCards=[{id:1,last4:'4242',brand:'Visa',expiryMonth:12,expiryYear:2025,isDefault:true},{id:2,last4:'5555',brand:'Mastercard',expiryMonth:8,expiryYear:2026,isDefault:false}];setSavedCards(mockSavedCards);setSelectedCard(mockSavedCards.find(card=>card.isDefault));}catch(error){console.error('Error loading saved cards:',error);}};const handlePackageChange=packageId=>{const selectedPackage=eventDetails.packages.find(pkg=>pkg.id===packageId);const subtotal=selectedPackage.price;const tax=Math.round(subtotal*0.18*100)/100;// 18% tax\nconst processingFee=4.99;const discount=promoApplied?Math.round(subtotal*0.1*100)/100:0;const total=subtotal+tax+processingFee-discount;setOrderSummary({selectedPackage,quantity:1,subtotal,tax,processingFee,discount,total});};const handleApplyPromoCode=()=>{if(promoCode.toLowerCase()==='save10'){setPromoApplied(true);const discount=Math.round(orderSummary.subtotal*0.1*100)/100;setOrderSummary({...orderSummary,discount,total:orderSummary.subtotal+orderSummary.tax+orderSummary.processingFee-discount});showSuccess('Promo Code Applied','10% discount applied successfully!');}else{showError('Invalid Promo Code','Please enter a valid promo code');}};const handlePaymentMethodChange=e=>{setPaymentMethod(e.target.value);};const createRazorpayOrder=async()=>{try{// Create order on backend\nconst orderData={amount:Math.round(orderSummary.total*100),// Amount in paise\ncurrency:'INR',receipt:`order_${Date.now()}`,eventId:eventId,packageId:orderSummary.selectedPackage.id,userId:user.id};// Mock API call - replace with actual API\nconst response={id:'order_'+Date.now(),currency:'INR',amount:orderData.amount};return response;}catch(error){console.error('Error creating order:',error);throw error;}};const handleRazorpayPayment=async()=>{try{setProcessing(true);const order=await createRazorpayOrder();const options={key:process.env.REACT_APP_RAZORPAY_KEY_ID||'rzp_test_key',amount:order.amount,currency:order.currency,name:'IBCM Events',description:`Payment for ${eventDetails.title}`,order_id:order.id,image:'/logo.png',handler:function(response){handlePaymentSuccess(response);},prefill:{name:user.name,email:user.email,contact:user.phone},notes:{eventId:eventId,userId:user.id},theme:{color:'#1890ff'},modal:{ondismiss:function(){setProcessing(false);showInfo('Payment Cancelled','Payment was cancelled by user');}}};const rzp=new window.Razorpay(options);rzp.on('payment.failed',function(response){handlePaymentFailure(response.error);});rzp.open();}catch(error){console.error('Error initiating payment:',error);showError('Payment Error','Failed to initiate payment. Please try again.');setProcessing(false);}};const handlePaymentSuccess=async response=>{try{// Verify payment on backend\nconst verificationData={razorpay_order_id:response.razorpay_order_id,razorpay_payment_id:response.razorpay_payment_id,razorpay_signature:response.razorpay_signature};// Mock verification - replace with actual API call\nconst verificationResult={success:true,paymentId:response.razorpay_payment_id,orderId:response.razorpay_order_id};if(verificationResult.success){setPaymentResult({success:true,paymentId:response.razorpay_payment_id,orderId:response.razorpay_order_id,amount:orderSummary.total});setCurrentStep(2);showSuccess('Payment Successful','Your payment has been processed successfully!');}else{throw new Error('Payment verification failed');}}catch(error){console.error('Payment verification error:',error);setPaymentResult({success:false,error:error.message});setCurrentStep(2);showError('Payment Verification Failed','Payment verification failed. Please contact support.');}finally{setProcessing(false);}};const handlePaymentFailure=error=>{console.error('Payment failed:',error);setPaymentResult({success:false,error:error.description||'Payment failed'});setCurrentStep(2);showError('Payment Failed',error.description||'Payment failed. Please try again.');setProcessing(false);};const handleProceedToPayment=()=>{if(paymentMethod==='card'||paymentMethod==='razorpay'){handleRazorpayPayment();}else{// Handle other payment methods\nshowInfo('Coming Soon','This payment method will be available soon');}};const renderPackageSelection=()=>/*#__PURE__*/_jsxs(\"div\",{className:\"package-selection\",children:[/*#__PURE__*/_jsx(Title,{level:3,children:\"Select Package\"}),/*#__PURE__*/_jsx(Row,{gutter:[16,16],children:eventDetails.packages.map(pkg=>/*#__PURE__*/_jsx(Col,{xs:24,md:8,children:/*#__PURE__*/_jsxs(Card,{className:`package-card ${orderSummary.selectedPackage.id===pkg.id?'package-selected':''}`,hoverable:true,onClick:()=>handlePackageChange(pkg.id),children:[pkg.recommended&&/*#__PURE__*/_jsx(\"div\",{className:\"package-badge\",children:/*#__PURE__*/_jsx(Tag,{color:\"gold\",children:\"Recommended\"})}),/*#__PURE__*/_jsx(Title,{level:4,className:\"package-name\",children:pkg.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"package-price\",children:[/*#__PURE__*/_jsx(Text,{className:\"price-currency\",children:\"\\u20B9\"}),/*#__PURE__*/_jsx(Text,{className:\"price-amount\",children:pkg.price})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(\"div\",{className:\"package-features\",children:pkg.features.map((feature,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"feature-item\",children:[/*#__PURE__*/_jsx(CheckCircleOutlined,{className:\"feature-icon\"}),/*#__PURE__*/_jsx(Text,{children:feature})]},index))})]})},pkg.id))})]});const renderPaymentMethods=()=>/*#__PURE__*/_jsxs(\"div\",{className:\"payment-methods\",children:[/*#__PURE__*/_jsx(Title,{level:3,children:\"Payment Method\"}),/*#__PURE__*/_jsx(Radio.Group,{value:paymentMethod,onChange:handlePaymentMethodChange,className:\"payment-method-group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method-options\",children:[/*#__PURE__*/_jsx(Radio,{value:\"card\",className:\"payment-method-option\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method-content\",children:[/*#__PURE__*/_jsx(CreditCardOutlined,{className:\"payment-method-icon\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method-text\",children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Credit/Debit Card\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Pay with your card\"})]})]})}),/*#__PURE__*/_jsx(Radio,{value:\"upi\",className:\"payment-method-option\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method-content\",children:[/*#__PURE__*/_jsx(MobileOutlined,{className:\"payment-method-icon\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method-text\",children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"UPI\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Pay with UPI ID\"})]})]})}),/*#__PURE__*/_jsx(Radio,{value:\"netbanking\",className:\"payment-method-option\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method-content\",children:[/*#__PURE__*/_jsx(BankOutlined,{className:\"payment-method-icon\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method-text\",children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Net Banking\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Pay with your bank\"})]})]})}),/*#__PURE__*/_jsx(Radio,{value:\"wallet\",className:\"payment-method-option\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method-content\",children:[/*#__PURE__*/_jsx(WalletOutlined,{className:\"payment-method-icon\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method-text\",children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Wallet\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Pay with digital wallet\"})]})]})})]})}),paymentMethod==='card'&&savedCards.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"saved-cards\",children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"Saved Cards\"}),/*#__PURE__*/_jsx(Radio.Group,{value:selectedCard===null||selectedCard===void 0?void 0:selectedCard.id,onChange:e=>setSelectedCard(savedCards.find(card=>card.id===e.target.value)),children:savedCards.map(card=>/*#__PURE__*/_jsx(Radio,{value:card.id,className:\"saved-card-option\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"saved-card-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-info\",children:[/*#__PURE__*/_jsxs(Text,{strong:true,children:[card.brand,\" \\u2022\\u2022\\u2022\\u2022 \",card.last4]}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[\"Expires \",card.expiryMonth.toString().padStart(2,'0'),\"/\",card.expiryYear]})]}),card.isDefault&&/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:\"Default\"})]})},card.id))}),/*#__PURE__*/_jsx(Button,{type:\"link\",className:\"add-new-card-btn\",children:\"+ Add New Card\"})]})]});const renderOrderSummary=()=>/*#__PURE__*/_jsxs(Card,{className:\"order-summary-card\",children:[/*#__PURE__*/_jsx(Title,{level:3,children:\"Order Summary\"}),/*#__PURE__*/_jsx(\"div\",{className:\"event-summary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"event-info\",children:[/*#__PURE__*/_jsx(Avatar,{src:eventDetails.image,size:64,shape:\"square\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-details\",children:[/*#__PURE__*/_jsx(Title,{level:4,children:eventDetails.title}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[eventDetails.date,\" \\u2022 \",eventDetails.time]}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:eventDetails.location})]})]})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"package-summary\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"summary-item\",children:[/*#__PURE__*/_jsxs(Text,{children:[orderSummary.selectedPackage.name,\" Package\"]}),/*#__PURE__*/_jsxs(Text,{children:[\"\\u20B9\",orderSummary.subtotal]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-item\",children:[/*#__PURE__*/_jsx(Text,{children:\"Tax (18%)\"}),/*#__PURE__*/_jsxs(Text,{children:[\"\\u20B9\",orderSummary.tax]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-item\",children:[/*#__PURE__*/_jsx(Text,{children:\"Processing Fee\"}),/*#__PURE__*/_jsxs(Text,{children:[\"\\u20B9\",orderSummary.processingFee]})]}),orderSummary.discount>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"summary-item discount\",children:[/*#__PURE__*/_jsx(Text,{children:\"Discount\"}),/*#__PURE__*/_jsxs(Text,{children:[\"-\\u20B9\",orderSummary.discount]})]})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"promo-code\",children:[/*#__PURE__*/_jsxs(Input.Group,{compact:true,children:[/*#__PURE__*/_jsx(Input,{placeholder:\"Enter promo code\",value:promoCode,onChange:e=>setPromoCode(e.target.value),style:{width:'70%'},disabled:promoApplied}),/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:handleApplyPromoCode,disabled:!promoCode||promoApplied,style:{width:'30%'},children:\"Apply\"})]}),promoApplied&&/*#__PURE__*/_jsxs(Text,{type:\"success\",className:\"promo-applied\",children:[/*#__PURE__*/_jsx(CheckCircleOutlined,{}),\" Promo code applied successfully!\"]})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(\"div\",{className:\"total-summary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"total-item\",children:[/*#__PURE__*/_jsx(Title,{level:3,children:\"Total\"}),/*#__PURE__*/_jsxs(Title,{level:3,className:\"total-amount\",children:[\"\\u20B9\",orderSummary.total]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"security-info\",children:[/*#__PURE__*/_jsx(SafetyOutlined,{className:\"security-icon\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Your payment information is secure and encrypted\"})]})]});const renderPaymentResult=()=>/*#__PURE__*/_jsx(\"div\",{className:\"payment-result\",children:paymentResult.success?/*#__PURE__*/_jsx(Result,{status:\"success\",title:\"Payment Successful!\",subTitle:`Payment ID: ${paymentResult.paymentId}`,extra:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>navigate(`/orders/${paymentResult.orderId}`),children:\"View Details\"},\"details\"),/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/events'),children:\"Browse More Events\"},\"events\")],children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment-success-details\",children:[/*#__PURE__*/_jsxs(Paragraph,{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Amount Paid: \"}),/*#__PURE__*/_jsxs(Text,{children:[\"\\u20B9\",paymentResult.amount]})]}),/*#__PURE__*/_jsxs(Paragraph,{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Event: \"}),/*#__PURE__*/_jsx(Text,{children:eventDetails.title})]}),/*#__PURE__*/_jsxs(Paragraph,{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Package: \"}),/*#__PURE__*/_jsx(Text,{children:orderSummary.selectedPackage.name})]}),/*#__PURE__*/_jsx(Paragraph,{type:\"secondary\",children:\"A confirmation email has been sent to your registered email address.\"})]})}):/*#__PURE__*/_jsx(Result,{status:\"error\",title:\"Payment Failed\",subTitle:paymentResult.error,extra:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>setCurrentStep(1),children:\"Try Again\"},\"retry\"),/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/support'),children:\"Contact Support\"},\"support\")]})});const steps=[{title:'Select Package',content:renderPackageSelection()},{title:'Payment Details',content:renderPaymentMethods()},{title:'Confirmation',content:renderPaymentResult()}];if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"payment-loading\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"payment-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"payment-header\",children:[/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(LeftOutlined,{}),onClick:()=>navigate(-1),className:\"back-button\",children:\"Back\"}),/*#__PURE__*/_jsx(Title,{level:2,children:\"Complete Payment\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"payment-content\",children:/*#__PURE__*/_jsxs(Row,{gutter:[32,32],children:[/*#__PURE__*/_jsx(Col,{xs:24,lg:16,children:/*#__PURE__*/_jsxs(Card,{className:\"payment-steps-card\",children:[/*#__PURE__*/_jsx(Steps,{current:currentStep,className:\"payment-steps\",children:steps.map((step,index)=>/*#__PURE__*/_jsx(Step,{title:step.title},index))}),/*#__PURE__*/_jsx(\"div\",{className:\"payment-step-content\",children:steps[currentStep].content}),currentStep<2&&/*#__PURE__*/_jsxs(\"div\",{className:\"payment-actions\",children:[currentStep>0&&/*#__PURE__*/_jsxs(Button,{onClick:()=>setCurrentStep(currentStep-1),className:\"prev-button\",children:[/*#__PURE__*/_jsx(LeftOutlined,{}),\" Previous\"]}),currentStep===0&&/*#__PURE__*/_jsxs(Button,{type:\"primary\",onClick:()=>setCurrentStep(1),className:\"next-button\",children:[\"Continue \",/*#__PURE__*/_jsx(RightOutlined,{})]}),currentStep===1&&/*#__PURE__*/_jsxs(Button,{type:\"primary\",onClick:handleProceedToPayment,loading:processing,className:\"pay-button\",children:[\"Pay \\u20B9\",orderSummary.total]})]})]})}),/*#__PURE__*/_jsx(Col,{xs:24,lg:8,children:renderOrderSummary()})]})})]});};export default PaymentScreen;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}